/**
	Open Innovations line charts in SVG
	
	0.5.0
		- better animation for lines/points when the number of points changes
		- alter tick offset/size setting
  */
!function(t){var e=t.OI||{};function r(t,e){if(this.version="0.5.0",!t)return console.error("No element to attach to"),this;var r,d,c,u,f,p,g,y,b,k,x,m,v,w,L,M,P,A;e||(e={}),u=new function(t){var e=document.createElement("div");return e.classList.add("spinner"),e.setAttribute("style","position:absolute;left:50%;top:50%;transform:translate3d(-50%,-50%,0);"),l(e,t),this.loading=function(){return e.innerHTML="Loading...",this},this.loaded=function(){return e.innerHTML="",this},this.remove=function(){return e&&e.parentNode.removeChild(e),this},this.error=function(t){return e&&(console.error(t),e.innerHTML='<span class="error">ERROR: '+t+"</span>"),this},this}(t).loading(),this.el=t,P="linechart",c="http://www.w3.org/2000/svg",v="number"==typeof e.duration?e.duration:"0s",r=t.clientWidth,d=t.clientHeight;var N=getComputedStyle(t);function S(t,e){M&&A.click&&A.click.trigger({i:e})}function C(){var t=n(f,"."+P+"-tooltip");return t&&t.parentNode.removeChild(t),A.hidetooltip&&A.hidetooltip.trigger(),!0}function F(t,e){return{x:t=w.left+(t-g)/(b-g)*(r-w.left-w.right),y:e=w.top+(1-(e-y)/(k-y))*(d-w.bottom-w.top)}}function E(t){return document.createElementNS(c,t)}function T(t,e,i){var n={line:{show:!0,stroke:"black","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":""},grid:{show:!1,stroke:"black","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":""},title:{},ticks:{show:!0},labels:{}};this.ticks={},this.line={},this.el=E("g"),h(this.el,[P+"-grid",P+"-grid-"+t]),this.title=E("text"),this.title.classList.add(P+"-grid-title"),l(this.title,this.el);var c=w["font-size"]||16;return l(this.el,f),this.setProperties=function(t){return o(n,t),this},this.getProperty=function(t){return n.hasOwnProperty(t)?n[t]:null},this.update=function(){var o,h,u,f,p,x,m,v,L;for(o in n.labels||(n.labels={}),this.title.innerHTML=n.title.label||"",h="x"==t?w.left+(r-w.right-w.left)/2:c/2,u="y"==t?w.top+(d-w.top-w.bottom)/2:d-c/2,a(this.title,{x:h,y:u,transform:"y"==t?"rotate(-90,"+h+","+u+")":""}),this.el.removeAttribute("style"),this.line.el||(this.line.el=E("path"),this.line.el.classList.add("line"),this.line.el.setAttribute("vector-effect","non-scaling-stroke"),l(this.line.el,this.el),this.line.animate=new O(this.line.el)),f=[{x:w.left-.5,y:d-w.bottom-.5},{x:"x"==t?r-w.right:w.left-.5,y:"x"==t?d-w.bottom-.5:w.top-.5}],this.line.animate.set({d:{from:"",to:f}}),a(this.line.el,{style:n.line.show?"display:block":"display:none",stroke:n.line.stroke,"stroke-width":n.line["stroke-width"],"stroke-dasharray":n.line["stroke-dasharray"]}),this.ticks)o&&!n.ticks.show&&(this.ticks[o].line&&this.ticks[o].line.parentNode.removeChild(this.ticks[o].line),this.ticks[o].text&&this.ticks[o].text.parentNode.removeChild(this.ticks[o].text),delete this.ticks[o]);for(o in n.labels)void 0!==o&&(void 0===n.labels[o]&&(n.labels[o]={label:""}),x=n.labels[o].align||("x"==t?"bottom":"left"),m=n.labels[o]["text-anchor"]||("y"==t?"left"==x?"end":"start":"middle"),baseline="x"==t?"bottom"==x?"hanging":"text-bottom":"middle",p="number"==typeof n.labels[o].ticksize?n.labels[o].ticksize:5,h="x"==t?parseFloat(o):"left"==x?g:b,u="x"==t?"bottom"==x?y:k:parseFloat(o),(e=F(h,u)).x=Math.round(e.x),i.x=Math.round(i.x),i=s(e),"x"==t?(n.grid.show&&h!=g&&(e.y="bottom"==x?w.top:d-w.bottom),i.y+="bottom"==x?p:-p):(n.grid.show&&u!=y&&(e.x="left"==x?r-w.right:w.left),i.x+="left"==x?-p:p),"x"==t&&(h<g||h>b)||"y"==t&&(u<y||u>k)?this.ticks[o]&&(this.ticks[o].line&&this.ticks[o].line.el.setAttribute("style","display:none"),this.ticks[o].text&&this.ticks[o].text.el.setAttribute("style","display:none")):(this.ticks[o]?(this.ticks[o].line&&this.ticks[o].line.el.removeAttribute("style"),this.ticks[o].text.el.removeAttribute("style")):(this.ticks[o]={text:{el:E("text")}},p>0&&(this.ticks[o].line={el:E("line")},this.ticks[o].line.animate=new O(this.ticks[o].line.el),l(this.ticks[o].line.el,this.el)),this.ticks[o].text.animate=new O(this.ticks[o].text.el),this.ticks[o].text.el.setAttribute("text-anchor",n["text-anchor"]||m),l(this.ticks[o].text.el,this.el)),this.ticks[o].line&&(this.ticks[o].line.animate.set({x1:{to:e.x-.5},x2:{to:i.x-.5},y1:{to:e.y-.5},y2:{to:i.y-.5}}),a(this.ticks[o].line.el,{stroke:n.grid.stroke,"stroke-width":n.grid["stroke-width"]})),this.ticks[o].text.el.innerHTML=n.labels[o].label||"",a(this.ticks[o].text.el,{stroke:n.labels[o].stroke||"black","stroke-width":n.labels[o]["stroke-width"]||0,fill:n.labels[o].fill||"black","dominant-baseline":baseline}),xsign="right"==n.labels[o].align?1:-1,ysign="top"==n.labels[o].align?-1:1,v=i.x+("y"==t?xsign*("number"==typeof n.labels[o].offset?n.labels[o].offset:4):0),L=i.y+("x"==t?ysign*("number"==typeof n.labels[o].offset?n.labels[o].offset:4):0),this.ticks[o].text.animate.set({x:{to:v},y:{to:L}})));l(this.line.el,this.el)},this}function H(e,r,d){var c,u,p,x,m;function v(e){var i=parseInt(e.target.getAttribute("data-i"));r[i]?function(e,i,r,o,s){var a,d,c,u,p;if(M)(d=n(M,"."+P+"-tooltip"))||(h(d=document.createElement("div"),[P+"-tooltip"]),l(d,M)),a=n(e,"title").innerHTML,o.label||(o.label=a),"function"==typeof s.label?a=s.label.call(e,{series:i,i:r,data:o}):"string"==typeof s.label&&(a=s.label),a=a.replace(/\n/g,"<br />"),d.innerHTML=a,c="","function"==typeof s.class?c=s.class.call(e,{series:i,i:r,data:o}):"string"==typeof s.class&&(c=s.class),c&&d.setAttribute("class",c),u=e.getBoundingClientRect(),p=f.getBoundingClientRect(),d.setAttribute("style","position:absolute;left:"+Math.round(u.left+u.width/2-p.left+t.scrollLeft)+"px;top:"+Math.round(u.top+u.height/2-p.top)+"px;transform:translate3d(-50%,-100%,0);display:"+(a?"block":"none")),l(M,f),A.showtooltip&&A.showtooltip.trigger({i:r})}(e.target,c,i,r[i],c.tooltip):console.error("Bad tooltip "+i,e)}return r||(r=[]),c={points:{show:!0,color:"black","stroke-linecap":"round",stroke:"black","stroke-width":0,"fill-opacity":1},line:{show:!0,color:"#000000","stroke-width":4,"stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":"",fill:"none"}},u={},p="",x=[],label="",this.el=E("g"),(m={id:c.id||"series-"+(e+1)})[P+"-series"]=e+1,a(this.el,m),h(this.el,[P+"-series",P+"-series-"+(e+1)]),this.select=function(){return u.el.classList.add("on"),this},this.selectItem=function(t){return t>=0&&x[t].el?v({target:x[t].el}):C(),this},this.deselect=function(){return u.el.classList.remove("on"),this},this.setData=function(t){return r=t||[],this},this.updateRange=function(){for(var t=0;t<r.length;t++)g=Math.min(g,r[t].x),y=Math.min(y,r[t].y),b=Math.max(b,r[t].x),k=Math.max(k,r[t].y);return this},this.getStyle=function(t,e){return c.hasOwnProperty(t)&&c[t].hasOwnProperty(e)?c[t][e]:null},this.getProperty=function(t){return c.hasOwnProperty(t)?c[t]:null},this.getProperties=function(){return c},this.setProperties=function(t){if(t||(t={}),o(c,t),c.class){var e=c.class.split(/ /);h(this.el,e)}return this},this.update=function(){var t,i,o,n,h,d,f,g;if(u.el||(u.el=E("path"),u.el.classList.add("line"),a(u.el,{d:"M0 0 L 100,100",stroke:c.line.color||"black"}),l(u.el,this.el),u.animate=new O(u.el),u.el.addEventListener("click",z)),a(u.el,{style:c.line.show?"display:block":"display:none",stroke:c.line.color||"black","stroke-width":this.getStyle("line","stroke-width"),"stroke-linecap":this.getStyle("line","stroke-linecap"),"stroke-linejoin":this.getStyle("line","stroke-linejoin"),"stroke-dasharray":this.getStyle("line","stroke-dasharray"),fill:this.getStyle("line","fill"),"vector-effect":"non-scaling-stroke"}),x.length>r.length)for(t=x.length-1;t>=r.length;t--)x[t].el.remove(),x.pop();if(x.length<r.length){for(i=x.length;i<r.length;i++)o=E("circle"),(g={cx:0,cy:0,"data-i":i,tabindex:0})[P+"-series"]=e+1,a(o,g),x[i]={el:o,title:E("title"),old:{}},r[i].label||(r[i].label="Point "+(i+1)),c.tooltip||(c.tooltip={}),n=r[i].label+": "+r[i].y.toFixed(2),"function"==typeof c.tooltip.label?n=c.tooltip.label.call(o,{series:c,i:i,data:r[i]}):"string"==typeof c.tooltip.label&&(n=c.tooltip.label),x[i].title.innerHTML=n,l(x[i].title,o),c.tooltip.label&&(o.addEventListener("mouseover",function(t){t.target.focus()}),o.addEventListener("focus",v)),o.addEventListener("click",function(t){var e=parseInt(t.target.getAttribute("data-i"));r[e]?S(t.target,e):console.error("Bad click "+e,t)}),l(o,this.el),x[i].c=new O(x[i].el);if(c.line.label){label=E("text"),label.innerHTML=c.title;var y=F(r[x.length-1].x,r[x.length-1].y);y["dominant-baseline"]="middle",y.fill=c.line.color||"black",c.line.label.padding&&(y.x+=c.line.label.padding),a(label,y),l(label,this.el)}}h=[];var b={};for(i=0;i<x.length;i++)d=(c["stroke-width"]||1)/2,c.points&&("number"==typeof c.points.size&&(d=Math.max(c.points.size,d)),"function"==typeof c.points.size&&(d=c.points.size.call(o,{series:e,i:i,data:r[i]}))),a(x[i].el,{r:d,fill:c.points.color,"fill-opacity":c.points["fill-opacity"],stroke:c.points.stroke,"stroke-width":c.points["stroke-width"]}),f=F(r[i].x,r[i].y),h.push(f),"number"==typeof x[i].old.x&&"number"==typeof x[i].old.y?b=s(x[i].old):"number"==typeof b.x&&"number"==typeof b.y&&(x[i].old=b),x[i].c.set({cx:{from:x[i].old.x||null,to:f.x},cy:{from:x[i].old.y||null,to:f.y}}),x[i].old=f;return u.animate.set({d:{from:p,to:h}}),p=s(h),this},this.remove=function(){for(u.el.parentNode&&u.el.parentNode.removeChild(u.el),i=0;i<x.length;i++)x[i].el.parentNode&&x[i].el.parentNode.removeChild(x[i].el)},this.setData(r),this.setProperties(d),l(this.el,f),this}function O(e,i){var r,o,n;return r=window.getComputedStyle(t),o=e.tagName.toLowerCase(),i||(i={}),n={},r["animation-duration"]&&(this.duration=r["animation-duration"]),i.duration&&(this.duration=i.duration),this.duration||(this.duration=v),this.duration=parseFloat(this.duration),this.set=function(t){var i,r,h,d,c,u;for(i in e.querySelectorAll("animate").forEach(function(t){t.parentNode.removeChild(t)}),t)if(i){if(c=t[i].from||"",u=t[i].to,!c&&n[i]&&(c=n[i].value),h=null,d=null,"path"==o){for(h="",d="",r=0;r<c.length;r++)h+=(r>0?"L":"M")+c[r].x.toFixed(2)+","+c[r].y.toFixed(2);for(r=0;r<u.length;r++)d+=(r>0?"L":"M")+u[r].x.toFixed(2)+","+u[r].y.toFixed(2);if(c.length>0&&c.length<u.length)for(r=0;r<u.length-c.length;r++)h+="L"+c[c.length-1].x.toFixed(2)+","+c[c.length-1].y.toFixed(2);if(u.length>0&&u.length<c.length)for(r=0;r<c.length-u.length;r++)d+="L"+u[u.length-1].x.toFixed(2)+","+u[u.length-1].y.toFixed(2);h||(h=null)}else c&&(h=s(c)),d=s(u);this.duration&&null!==h&&(n[i]||(n[i]={}),n[i].el=E("animate"),a(n[i].el,{attributeName:i,dur:this.duration||0,repeatCount:"1"}),l(n[i].el,e)),e.setAttribute(i,d),this.duration&&null!==h&&(a(n[i].el,{from:h,to:d,values:h+";"+d}),n[i].el.beginElement(),n[i].value=u)}return this},this}function R(){g=1e100,y=1e100,b=-1e100,k=-1e100;for(var t=0;t<p.length;t++)p[t].updateRange();"number"==typeof L.x.getProperty("min")&&(g=L.x.getProperty("min")),"number"==typeof L.x.getProperty("max")&&(b=L.x.getProperty("max")),"number"==typeof L.y.getProperty("min")&&(y=L.y.getProperty("min")),"number"==typeof L.y.getProperty("max")&&(k=L.y.getProperty("max"))}function z(t){for(var e=parseInt(t.currentTarget.closest("g").getAttribute(P+"-series"))-1,i=0;i<p.length;i++)e==i?p[i].select():p[i].deselect();l(p[e].el,p[e].el.closest("svg")),m&&l(m.el,m.el.closest("svg")),n(t.target.parentNode,"circle").focus(),l(M,f)}return d-=parseFloat(N.paddingTop)+parseFloat(N.paddingBottom),r-=parseFloat(N.paddingLeft)+parseFloat(N.paddingRight),p=[],A={},o(w={left:0,top:0,right:0,bottom:0,tick:5,"font-size":16,tooltip:{},key:{show:!1,border:{stroke:"black","stroke-width":1,fill:"none"},text:{"text-anchor":"start","dominant-baseline":"hanging","font-weight":"bold",fill:"black","stroke-width":0,"font-family":"sans-serif"}},axis:{x:{},y:{}}},e),f||(a(f=E("svg"),{xmlns:c,version:"1.1",width:r,height:d,viewBox:"0 0 "+r+" "+d,overflow:"visible",style:"max-width:100%;",preserveAspectRatio:"xMinYMin meet"}),l(x=E("defs"),f),l(f,t),t.addEventListener("mouseleave",function(t){C()}),a(M=E("foreignObject"),{width:1,height:1,overflow:"visible"}),l(M,f)),(L={x:new T("x",w.left,r-w.right-w.left),y:new T("y",w.bottom,d-w.top-w.bottom)}).x.setProperties(w.axis.x||{}),L.y.setProperties(w.axis.y||{}),this.on=function(t,e,i){return"function"==typeof e&&(i=s(e),delete e),A[t]=new function(t,e){"function"==typeof t&&(e=t,t={});this.trigger=function(i){var r=t;o(r,i),e.call(r.this||this,r)}}(e,i),this},this.off=function(t){return delete A[t],this},this.getSVG=function(){return f.querySelectorAll("animate").forEach(function(t){t.parentNode.removeChild(t)}),f.outerHTML},this.setProperties=function(t){return o(w,t||{}),L.x.setProperties(w.axis.x||{}),L.y.setProperties(w.axis.y||{}),this},this.addSeries=function(t,e){return t?(e||(e={}),p.push(new H(p.length,t,e)),R(),this.series=p,this):(u.error("No data in series"),this)},this.clear=function(){for(var t=0;t<p.length;t++)p[t].remove();return p=[],this.series=[],this.draw()},this.draw=function(){var t,e,i,o,s,d,c,u,g,y,b,k,M,A;for(C(),R(),L.x.update(),L.y.update(),t="<style>",t+="\t."+P+"-series circle { transition: transform "+v+" linear, r "+v+" linear; }\n",t+="\t."+P+"-series circle:focus { stroke-width: 4; }\n",t+="\t."+P+"-series:hover path.line, ."+P+"-series.on path.line { cursor:pointer; }\n",e=0;e<p.length;e++)p[e].update(),t+="\t."+P+"-series-"+(e+1)+":hover path.line, ."+P+"-series-"+(e+1)+".on path.line { stroke-width: "+(p[e].getProperty("stroke-width-hover")||4)+"; }\n";if(w.key.show){if(i=w["font-size"]||16,o=w.key.padding||5,s=(w.key.label?1:0)*i+2*o+p.length*i,c=0,u=0,!m){if((m={el:E("g"),g:[],border:E("rect")}).el.classList.add("key"),a(m.border,{x:0,y:w.top,width:r,height:s}),"object"==typeof w.key.border)for(M in w.key.border)m.border.setAttribute(M,w.key.border[M]);l(m.border,m.el),l(m.el,f)}for(d=0,g=0;g<p.length;g++)m.g[g]||(m.g[g]=E("g"),m.g[g].setAttribute(P+"-series",g),A=[P+"-series",P+"-series-"+(g+1)],p[g].getProperty("class")&&A.concat(p[g].getProperty("class").split(/ /)),h(m.g[g],A),l(m.g[g],m.el),m.g[g].addEventListener("mouseover",z)),m.g[g].innerHTML='<text><tspan dx="'+2*i+'" dy="0">'+(p[g].getProperty("title")||"Series "+(g+1))+'</tspan></text><path d="M0 0 L 1 0" class="line" class="" stroke-width="3" stroke-linecap="round"></path><circle cx="0" cy="0" r="5" fill="silver"></circle>',d=Math.max(d,m.g[g].getBoundingClientRect().width);for(c=r-w.right-d-o,u=w.top,a(m.border,{x:c,width:d+o}),u+=o,c+=o,g=0;g<p.length;g++){if(y=n(m.g[g],"text"),b=n(m.g[g],"path"),k=n(m.g[g],"circle"),y.setAttribute("x",c),y.setAttribute("y",u+g*i+.2*i),"object"==typeof w.key.text)for(M in w.key.text)y.setAttribute(M,w.key.text[M]);b.setAttribute("d","M"+c+","+(u+(.5+g)*i)+" l "+1.5*i+" 0"),a(k,{cx:c+.75*i,cy:u+(.5+g)*i,fill:(M=p[g].getProperties()).points.color||"","stroke-width":M.points["stroke-width"]||0,stroke:M.points.stroke||""}),M.line.color&&b.setAttribute("stroke",M.line.color)}}return t+="\t."+P+"-grid."+P+"-grid-x ."+P+"-grid-title,."+P+"-grid."+P+"-grid-y ."+P+"-grid-title { text-anchor: middle; dominant-baseline: central; }\n",t+="\t."+P+"-grid."+P+"-grid-y text { dominant-baseline: "+((w.axis.y.labels?w.axis.y.labels.baseline:"")||"middle")+"; }\n",t+="\t."+P+"-tooltip { background: black; color: white; padding: 0.25em 0.5em; margin-top: -1em; transition: left 0.1s linear, top 0.1s linear; border-radius: 4px; white-space: nowrap; }\n",t+="\t."+P+'-tooltip::after { content: ""; position: absolute; bottom: auto; width: 0; height: 0; border: 0.5em solid transparent; left: 50%; top: 100%; transform: translate3d(-50%,0,0); border-color: transparent; border-top-color: black; }\n',t+="\t</style>\n",x&&(x.innerHTML=t),this},u.remove(),this}function o(t,e){for(var i in e)try{e[i].constructor==Object?t[i]=o(t[i],e[i]):t[i]=e[i]}catch(r){t[i]=e[i]}return t}function n(t,e){return t.querySelector(e)}function l(t,e){return e.appendChild(t)}function s(t){return JSON.parse(JSON.stringify(t))}function a(t,e){for(var i in e)t.setAttribute(i,e[i]);return t}function h(t,e){for(var i=0;i<e.length;i++)t.classList.add(e[i]);return t}e.ready||(e.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)}),e.linechart=function(t,e){return new r(t,e)},t.OI=e}(window||this);