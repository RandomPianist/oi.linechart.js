/**
	ODI Leeds line charts in SVG
	Version 0.4.3
  */
!function(t){var e=t.ODI||{};function i(t,e){if(!t)return console.error("No element to attach to"),this;var i,h,d,c,u,p,f,g,y,k,b,x,m,w,v,L,M;e||(e={}),c=new function(t){var e=document.createElement("div");return e.classList.add("spinner"),e.setAttribute("style","position:absolute;left:50%;top:50%;transform:translate3d(-50%,-50%,0);"),o(e,t),this.loading=function(){return e.innerHTML="Loading...",this},this.loaded=function(){return e.innerHTML="",this},this.remove=function(){return e&&e.parentNode.removeChild(e),this},this.error=function(t){return e&&(console.error(t),e.innerHTML='<span class="error">ERROR: '+t+"</span>"),this},this}(t).loading(),this.el=t,M="linechart",d="http://www.w3.org/2000/svg",m=e.duration||"0.3s",i=t.clientWidth,h=t.clientHeight;var P=getComputedStyle(t);function A(){var t=s(u,"."+M+"-tooltip");return t&&t.parentNode.removeChild(t),!0}function S(t,e){return{x:t=w.left+(t-f)/(y-f)*(i-w.left-w.right),y:e=w.top+(1-(e-g)/(k-g))*(h-w.bottom-w.top)}}function C(t){return document.createElementNS(d,t)}function N(t,e,s){var d={line:{show:!0,stroke:"black","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":""},grid:{show:!1,stroke:"black","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":""},title:{},ticks:{show:!0},labels:{}};this.ticks={},this.line={},this.el=C("g"),a(this.el,[M+"-grid",M+"-grid-"+t]),this.title=C("text"),this.title.classList.add(M+"-grid-title"),o(this.title,this.el);var c=w["font-size"]||16;return o(this.el,u),this.setProperties=function(t){return r(d,t),this},this.getProperty=function(t){return d.hasOwnProperty(t)?d[t]:null},this.update=function(){var r,a,u,p,b,x,m,v,L;for(r in d.labels||(d.labels={}),this.title.innerHTML=d.title.label||"",a="x"==t?w.left+(i-w.right-w.left)/2:c/2,u="y"==t?w.top+(h-w.top-w.bottom)/2:h-c/2,l(this.title,{x:a,y:u,transform:"y"==t?"rotate(-90,"+a+","+u+")":""}),this.el.removeAttribute("style"),this.line.el||(this.line.el=C("path"),this.line.el.classList.add("line"),this.line.el.setAttribute("vector-effect","non-scaling-stroke"),o(this.line.el,this.el),this.line.animate=new T(this.line.el)),p=[{x:w.left-.5,y:h-w.bottom-.5},{x:"x"==t?i-w.right:w.left-.5,y:"x"==t?h-w.bottom-.5:w.top-.5}],this.line.animate.set({d:{from:"",to:p}}),l(this.line.el,{style:d.line.show?"display:block":"display:none",stroke:d.line.stroke,"stroke-width":d.line["stroke-width"],"stroke-dasharray":d.line["stroke-dasharray"]}),this.ticks)r&&!d.ticks.show&&(this.ticks[r].line&&this.ticks[r].line.parentNode.removeChild(this.ticks[r].line),this.ticks[r].text&&this.ticks[r].text.parentNode.removeChild(this.ticks[r].text),delete this.ticks[r]);for(r in d.labels)void 0!==r&&(x=d.labels[r].align||("x"==t?"bottom":"left"),m=d.labels[r]["text-anchor"]||("y"==t?"left"==x?"end":"start":"middle"),b="number"==typeof d.labels[r].length?d.labels[r].length:5,a="x"==t?parseFloat(r):"left"==x?f:y,u="x"==t?"bottom"==x?g:k:parseFloat(r),(e=S(a,u)).x=Math.round(e.x),s.x=Math.round(s.x),s=n(e),"x"==t?(d.grid.show&&a!=f&&(e.y="bottom"==x?w.top:h-w.bottom),s.y+="bottom"==x?b:-b):(d.grid.show&&u!=g&&(e.x="left"==x?i-w.right:w.left),s.x+="left"==x?-b:b),"x"==t&&(a<f||a>y)||"y"==t&&(u<g||u>k)?this.ticks[r]&&(this.ticks[r].line&&this.ticks[r].line.el.setAttribute("style","display:none"),this.ticks[r].text&&this.ticks[r].text.el.setAttribute("style","display:none")):(this.ticks[r]?(this.ticks[r].line&&this.ticks[r].line.el.removeAttribute("style"),this.ticks[r].text.el.removeAttribute("style")):(this.ticks[r]={text:{el:C("text")}},b>0&&(this.ticks[r].line={el:C("line")},this.ticks[r].line.animate=new T(this.ticks[r].line.el),o(this.ticks[r].line.el,this.el)),this.ticks[r].text.animate=new T(this.ticks[r].text.el),this.ticks[r].text.el.setAttribute("text-anchor",d["text-anchor"]||m),o(this.ticks[r].text.el,this.el)),this.ticks[r].line&&(this.ticks[r].line.animate.set({x1:{to:e.x-.5},x2:{to:s.x-.5},y1:{to:e.y-.5},y2:{to:s.y-.5}}),l(this.ticks[r].line.el,{stroke:d.grid.stroke,"stroke-width":d.grid["stroke-width"]})),this.ticks[r].text.el.innerHTML=d.labels[r].label,l(this.ticks[r].text.el,{stroke:d.labels[r].stroke||"black","stroke-width":d.labels[r]["stroke-width"]||0,fill:d.labels[r].fill||"black"}),v=s.x+(d.labels[r].dx||0)+("y"==t?4*("right"==d.labels[r].align?1:-1):0),L=s.y+(d.labels[r].dy||0)+("x"==t?4*("bottom"==d.labels[r].align?-1:1):0),this.ticks[r].text.animate.set({x:{to:v},y:{to:L}})));o(this.line.el,this.el)},this}function E(e,i,h){var d,c,p,b,x;function m(e){var r=parseInt(e.target.getAttribute("data-i"));i[r]?function(e,i,r,n,l){var h,d,c,p,f;if(L)(d=s(L,"."+M+"-tooltip"))||(a(d=document.createElement("div"),[M+"-tooltip"]),o(d,L)),h=s(e,"title").innerHTML,n.label||(n.label=h),"function"==typeof l.label?h=l.label.call(e,{series:i,i:r,data:n}):"string"==typeof l.label&&(h=l.label),h=h.replace(/\n/g,"<br />"),d.innerHTML=h,c="","function"==typeof l.class?c=l.class.call(e,{series:i,i:r,data:n}):"string"==typeof l.class&&(c=l.class),c&&d.setAttribute("class",c),p=e.getBoundingClientRect(),f=u.getBoundingClientRect(),d.setAttribute("style","position:absolute;left:"+Math.round(p.left+p.width/2-f.left+t.scrollLeft)+"px;top:"+Math.round(p.top+p.height/2-f.top)+"px;transform:translate3d(-50%,-100%,0);display:"+(h?"block":"none")),o(L,u)}(e.target,d,r,i[r],d.tooltip):console.error("Bad tooltip "+r,e)}return i||(i=[]),d={points:{show:!0,color:"black","stroke-linecap":"round",stroke:"black","stroke-width":0},line:{show:!0,color:"#000000","stroke-width":4,"stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":"",fill:"none"}},c={},p="",b=[],this.el=C("g"),(x={id:d.id||"series-"+(e+1)})[M+"-series"]=e+1,l(this.el,x),a(this.el,[M+"-series",M+"-series-"+(e+1)]),this.select=function(){return c.el.classList.add("on"),this},this.deselect=function(){return c.el.classList.remove("on"),this},this.setData=function(t){return i=t||[],this},this.updateRange=function(){for(var t=0;t<i.length;t++)f=Math.min(f,i[t].x),g=Math.min(g,i[t].y),y=Math.max(y,i[t].x),k=Math.max(k,i[t].y);return this},this.getStyle=function(t,e){return d.hasOwnProperty(t)&&d[t].hasOwnProperty(e)?d[t][e]:null},this.getProperty=function(t){return d.hasOwnProperty(t)?d[t]:null},this.getProperties=function(){return d},this.setProperties=function(t){if(t||(t={}),r(d,t),d.class){var e=d.class.split(/ /);a(this.el,e)}return this},this.update=function(){var t,r,s,a,h,u,f,g;if(c.el||(c.el=C("path"),c.el.classList.add("line"),l(c.el,{d:"M0 0 L 100,100",stroke:d.line.color||"black"}),o(c.el,this.el),c.animate=new T(c.el),c.el.addEventListener("click",O)),l(c.el,{style:d.line.show?"display:block":"display:none",stroke:d.line.color||"black","stroke-width":this.getStyle("line","stroke-width"),"stroke-linecap":this.getStyle("line","stroke-linecap"),"stroke-linejoin":this.getStyle("line","stroke-linejoin"),"stroke-dasharray":this.getStyle("line","stroke-dasharray"),fill:this.getStyle("line","fill"),"vector-effect":"non-scaling-stroke"}),b.length>i.length)for(t=b.length-1;t>=i.length;t--)b[t].el.remove(),b.pop();if(b.length<i.length)for(r=b.length;r<i.length;r++)s=C("circle"),(g={cx:0,cy:0,"data-i":r,tabindex:0})[M+"-series"]=e+1,l(s,g),b[r]={el:s,title:C("title"),old:{}},i[r].label||(i[r].label="Point "+(r+1)),d.tooltip||(d.tooltip={}),a=i[r].label+": "+i[r].y.toFixed(2),"function"==typeof d.tooltip.label?a=d.tooltip.label.call(s,{series:d,i:r,data:i[r]}):"string"==typeof d.tooltip.label&&(a=d.tooltip.label),b[r].title.innerHTML=a,o(b[r].title,s),d.tooltip.label&&(s.addEventListener("mouseover",function(t){t.target.focus()}),s.addEventListener("focus",m)),o(s,this.el),b[r].cx=new T(b[r].el),b[r].cy=new T(b[r].el);for(h=[],r=0;r<b.length;r++)u=(d["stroke-width"]||1)/2,d.points&&("number"==typeof d.points.size&&(u=Math.max(d.points.size,u)),"function"==typeof d.points.size&&(u=d.points.size.call(s,{series:e,i:r,data:i[r]}))),l(b[r].el,{r:u,fill:d.points.color,stroke:d.points.stroke,"stroke-width":d.points["stroke-width"]}),f=S(i[r].x,i[r].y),h.push(f),b[r].cx.set({cx:{from:b[r].old.x||null,to:f.x}}),b[r].cy.set({cy:{from:b[r].old.y||null,to:f.y}}),b[r].old=f;return c.animate.set({d:{from:p,to:h}}),p=n(h),this},this.setData(i),this.setProperties(h),o(this.el,u),this}function T(e,i){var r,s,a;return r=window.getComputedStyle(t),s=e.tagName.toLowerCase(),i||(i={}),a={},"0s"!=r["animation-duration"]&&(this.duration=r["animation-duration"]),i.duration&&(this.duration=i.duration),this.duration||(this.duration=m),this.set=function(t){var i,r,h,d,c,u;for(i in e.querySelectorAll("animate").forEach(function(t){t.parentNode.removeChild(t)}),t)if(i){if(c=t[i].from||"",u=t[i].to,!c&&a[i]&&(c=a[i].value),h=null,d=null,"path"==s){for(h="",d="",r=0;r<c.length;r++)h+=(r>0?"L":"M")+c[r].x.toFixed(2)+","+c[r].y.toFixed(2);for(r=0;r<u.length;r++)d+=(r>0?"L":"M")+u[r].x.toFixed(2)+","+u[r].y.toFixed(2);h||(h=null)}else c&&(h=n(c)),d=n(u);this.duration&&null!==h&&(a[i]||(a[i]={}),a[i].el=C("animate"),l(a[i].el,{attributeName:i,dur:this.duration||0,repeatCount:"1"}),o(a[i].el,e)),e.setAttribute(i,d),this.duration&&null!==h&&(l(a[i].el,{from:h,to:d,values:h+";"+d}),a[i].el.beginElement(),a[i].value=u)}return this},this}function H(){f=1e100,g=1e100,y=-1e100,k=-1e100;for(var t=0;t<p.length;t++)p[t].updateRange();"number"==typeof v.x.getProperty("min")&&(f=v.x.getProperty("min")),"number"==typeof v.x.getProperty("max")&&(y=v.x.getProperty("max")),"number"==typeof v.y.getProperty("min")&&(g=v.y.getProperty("min")),"number"==typeof v.y.getProperty("max")&&(k=v.y.getProperty("max"))}function O(t){for(var e=parseInt(t.currentTarget.closest("g").getAttribute(M+"-series"))-1,i=0;i<p.length;i++)e==i?p[i].select():p[i].deselect();o(p[e].el,p[e].el.closest("svg")),x&&o(x.el,x.el.closest("svg")),s(t.target.parentNode,"circle").focus(),o(L,u)}return h-=parseFloat(P.paddingTop)+parseFloat(P.paddingBottom),i-=parseFloat(P.paddingLeft)+parseFloat(P.paddingRight),p=[],r(w={left:0,top:0,right:0,bottom:0,tick:5,"font-size":16,tooltip:{},key:{show:!1,border:{stroke:"black","stroke-width":1,fill:"none"},text:{"text-anchor":"start","dominant-baseline":"hanging","font-weight":"bold",fill:"black","stroke-width":0,"font-family":"sans-serif"}},axis:{x:{},y:{}}},e),u||(l(u=C("svg"),{xmlns:d,version:"1.1",width:i,height:h,viewBox:"0 0 "+i+" "+h,overflow:"visible",style:"max-width:100%;",preserveAspectRatio:"xMinYMin meet"}),o(b=C("defs"),u),o(u,t),t.addEventListener("mouseleave",function(t){A()}),l(L=C("foreignObject"),{width:1,height:1,overflow:"visible"}),o(L,u)),(v={x:new N("x",w.left,i-w.right-w.left),y:new N("y",w.bottom,h-w.top-w.bottom)}).x.setProperties(w.axis.x||{}),v.y.setProperties(w.axis.y||{}),this.getSVG=function(){return u.querySelectorAll("animate").forEach(function(t){t.parentNode.removeChild(t)}),u.outerHTML},this.setProperties=function(t){return r(w,t||{}),this},this.addSeries=function(t,e){return t?(e||(e={}),p.push(new E(p.length,t,e)),H(),this.series=p,this):(c.error("No data in series"),this)},this.draw=function(){var t,e,r,n,h,d,c,f,g,y,k,L,P,S;for(A(),H(),v.x.update(),v.y.update(),t="<style>",t+="\t."+M+"-series circle { transition: transform "+m+" linear, r "+m+" linear; }\n",t+="\t."+M+"-series circle:focus { stroke: black; stroke-width: 4; }\n",t+="\t."+M+"-series:hover path.line, ."+M+"-series.on path.line { cursor:pointer; }\n",t+="\t."+M+"-series path.line.dotted { stroke-dasharray: 12 20 }\n",e=0;e<p.length;e++)p[e].update(),t+="\t."+M+"-series-"+(e+1)+":hover path.line, ."+M+"-series-"+(e+1)+".on path.line { stroke-width: "+(p[e].getProperty("stroke-width-hover")||4)+"; }\n";if(w.key.show){if(r=w["font-size"]||16,n=w.key.padding||5,h=(w.key.label?1:0)*r+2*n+p.length*r,c=0,f=0,!x){if((x={el:C("g"),g:[],border:C("rect")}).el.classList.add("key"),l(x.border,{x:0,y:w.top,width:i,height:h}),"object"==typeof w.key.border)for(P in w.key.border)x.border.setAttribute(P,w.key.border[P]);o(x.border,x.el),o(x.el,u)}for(d=0,g=0;g<p.length;g++)x.g[g]||(x.g[g]=C("g"),x.g[g].setAttribute(M+"-series",g),S=[M+"-series",M+"-series-"+(g+1)],p[g].getProperty("class")&&S.concat(p[g].getProperty("class").split(/ /)),a(x.g[g],S),o(x.g[g],x.el),x.g[g].addEventListener("mouseover",O)),x.g[g].innerHTML='<text><tspan dx="'+2*r+'" dy="0">'+(p[g].getProperty("title")||"Series "+(g+1))+'</tspan></text><path d="M0 0 L 1 0" class="line" class="" stroke-width="3" stroke-linecap="round"></path><circle cx="0" cy="0" r="5" fill="silver"></circle>',d=Math.max(d,x.g[g].getBoundingClientRect().width);for(c=i-w.right-d-n,f=w.top,l(x.border,{x:c,width:d+n}),f+=n,c+=n,g=0;g<p.length;g++){if(y=s(x.g[g],"text"),k=s(x.g[g],"path"),L=s(x.g[g],"circle"),y.setAttribute("x",c),y.setAttribute("y",f+g*r+.2*r),"object"==typeof w.key.text)for(P in w.key.text)y.setAttribute(P,w.key.text[P]);k.setAttribute("d","M"+c+","+(f+(.5+g)*r)+" l "+1.5*r+" 0"),l(L,{cx:c+.75*r,cy:f+(.5+g)*r,fill:(P=p[g].getProperties()).points.color||"","stroke-width":P.points["stroke-width"]||0,stroke:P.points.stroke||""}),P.line.color&&k.setAttribute("stroke",P.line.color)}}return t+="\t."+M+"-grid."+M+"-grid-x ."+M+"-grid-title,."+M+"-grid."+M+"-grid-y ."+M+"-grid-title { text-anchor: middle; dominant-baseline: central; }\n",t+="\t."+M+"-grid."+M+"-grid-x text { dominant-baseline: hanging; }\n",t+="\t."+M+"-grid."+M+"-grid-y text { dominant-baseline: "+(w.axis.y.labels.baseline||"middle")+"; }\n",t+="\t."+M+"-tooltip { background: black; color: white; padding: 0.25em 0.5em; margin-top: -1em; transition: left 0.1s linear, top 0.1s linear; border-radius: 4px; white-space: nowrap; }\n",t+="\t."+M+'-tooltip::after { content: ""; position: absolute; bottom: auto; width: 0; height: 0; border: 0.5em solid transparent; left: 50%; top: 100%; transform: translate3d(-50%,0,0); border-color: transparent; border-top-color: black; }\n',t+="\t</style>\n",b&&(b.innerHTML=t),this},c.remove(),this}function r(t,e){for(var i in e)try{e[i].constructor==Object?t[i]=r(t[i],e[i]):t[i]=e[i]}catch(r){t[i]=e[i]}return t}function s(t,e){return t.querySelector(e)}function o(t,e){return e.appendChild(t)}function n(t){return JSON.parse(JSON.stringify(t))}function l(t,e){for(var i in e)t.setAttribute(i,e[i]);return t}function a(t,e){for(var i=0;i<e.length;i++)t.classList.add(e[i]);return t}e.ready||(e.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)}),e.linechart=function(t,e){return new i(t,e)},t.ODI=e}(window||this);